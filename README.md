# Daily-Snow-Depth
This repo contains scripts to generate visualizations of daily U.S. snow depth.

**DISCLAIMER: I am relatively new to programming and had very little experience with UNIX shell scripting, Python, and especially QGIS and Avisynth before I started this project. Therefore, there are bound to be more than a few inefficiencies and quirks in my code. Feedback and improvements/enhancements are welcomed and encouraged! After all, that's what sharing code is all about, right?

The following guide explains how to download the underlying dataset, format it, import it into QGIS, and ultimately combine the resulting map frames into a timelapse video.

1. Download the raw data 
  1. **This step requires wget, available [here](http://gnuwin32.sourceforge.net/packages/wget.htm) for Windows**
  2. The data we want to use is provided by the National Climate Data Center's Global Historical Climatological Network, and is available via FTP server [here](https://gis.ncdc.noaa.gov/geoportal/catalog/search/resource/details.page?id=gov.noaa.ncdc:C00861).
  3. To download some or all of the yearly GHCND files (CAUTION: over 13 GB total!):
    1. Edit `download_by_year.bat` to specify the year range to download
    2. Edit `download_by_year.bat` to specify the save directory
  4. Extract the csv files within these `.gz` files using a utility like 7-zip
2. Format the raw data
  1. **This step requires a Unix shell. If you are on Windows, consider [Cygwin](https://www.cygwin.com/):**
  2. These `.csv` files contain all weather data for every station in the Global Historical Climate Network (GHCN). We only need the snow depth data from U.S. stations.
  3. From the terminal (on Windows, open Cygwin), navigate to the location of the csv files.
  4. Run `format_raw_data.sh` from the Cygwin terminal. This will create a new directory containing daily csv files for snow depth data at continental U.S. stations. The files are named in the following way: `YYYYMMDD.csv`
3. Create spatially-interpolated snow depth maps
  1. **This step requires [QGIS](http://www.qgis.org/), and specifically, QGIS 2.10 Pisa.**
	1. The script is not working with more recent QGIS versions (such as 2.14 Essen) due to a backwards compatibility issue in some of the processing algorithms.
	2. Links to the older QGIS 2.10 Windows installation binaries
		1. [QGIS-OSGeo4W-2.10.1-1-Setup-x86.exe](https://qgis.org/downloads/QGIS-OSGeo4W-2.10.1-1-Setup-x86.exe) (32-bit version)
		2. [QGIS-OSGeo4W-2.10.1-1-Setup-x86_64.exe](https://qgis.org/downloads/QGIS-OSGeo4W-2.10.1-1-Setup-x86_64.exe) (64-bit version)
  2. Open QGIS 2.10
  3. Uncheck the box next to "Render" in the QGIS window. This will speeds up the script because it prevents QGIS from displaying the intermediate canvases during processing.
  4. Click the Python logo to open the Python Console within QGIS.
  5. Click "Show Editor"
  6. Click "Open file" and load the `QGIS_Snow_Depth_Renderer.py` script.
  7. ***IMPORTANT*** : In line 6 of `QGIS_Snow_Depth_Renderer.py`, you will need to specify the path to your Daily-Snow-Depth GitHub repository.
  8. Please take note of the warnings and suggestions below **BEFORE** running `QGIS_Snow_Depth_Renderer.py`.
    * This is a very time-consuming and processor-intensive task; rendering takes approximately 30-45 seconds *per map*.
    * I recommend only running the script for a few years' worth of daily files (up to a decade) at a time, since the temporary files generated by QGIS take up a lot of space and are not removed until the QGIS session is terminated. **If you know/find a way to delete temp files while the script is running, please share it!**
    * You may need to go in and manually delete the temp files if QGIS fails to remove them. On Windows, the default temp directory is something like C:\Users\\[your-name-here]\AppData\Local\Temp\processing
    * If you are using an SSD for OS and installed programs and a larger HDD for bulk storage, consider changing the environment variable of the QGIS temp directory to a location on the HDD, as explained here: http://gis.stackexchange.com/a/156156
  9. Run `QGIS_Snow_Depth_Renderer.py`, which will save the individual map files to the `QGIS_Python/Rendered_Frames/` directory in `YYYYMMDD.png` format.
4. Create timelapse video from daily map images
  1. **This step requires the following:
    * Avisynth, available [here](http://sourceforge.net/projects/avisynth2/)
    * MeGUI, available here: 
    * An up-to-date version of ffmpeg, available [here](https://www.ffmpeg.org/download.html) (or [here](http://ffmpeg.zeranoe.com/builds/) if you wish to use a build that has already been compiled)